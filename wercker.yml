box: python:2.7

services:
   - id: mdillon/postgis
     env:
       POSTGRES_PASSWORD: cb

build:
  steps:

    - install-packages:
        packages: libgeos-dev python-dev gdal-bin libjpeg-dev zlib1g-dev git pngcrush

    - virtualenv:
        name: setup virtual environment
        install_wheel: true

    - script:
        name: fix pillow link
        code: |
          ln -s /usr/include/freetype2 /usr/local/include/freetype

    - pip-install

    - script:
        name: django test
        code: |
          coverage run --source='.' manage.py test apps.api2 -k -v2
          coverage report
