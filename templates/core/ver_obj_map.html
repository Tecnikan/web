<!DOCTYPE html>
<html style="height:100%;width:100%;margin:0;padding:0">
    <head>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
    </head>
    <body style="height:100%;width:100%;margin:0;padding:0">
        <div id="map" style="background:lightblue; height:100%; width:100%"></div>
        <script type="text/javascript">
            map = new L.Map('map', { zoomControl:false });
            {% if obj.poligono %}
            map.fitBounds(L.geoJson({{ obj.poligono.geojson|safe }}));
            {% elif obj.ruta %}
            map.fitBounds(L.geoJson({{ obj.ruta.geojson|safe }}));
            {% else %}
            map.fitBounds(L.geoJson({{ obj.envolvente.geojson|safe }}));
            {% endif %}
            var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?pepe=asd';
            var osmAttrib='&copy; Cualbondi &amp; OpenStreetMap contributors';
            var osm = new L.TileLayer(osmUrl, {maxZoom: 17, fadeAnimation: false});
            map.attributionControl.setPrefix('Leaflet').addAttribution( osmAttrib );
            map.addLayer(osm);

            //map.setView(L.latLng({{ ciudad_actual.centro.get_y|stringformat:"f" }},{{ ciudad_actual.centro.get_x|stringformat:"f" }}), {{ ciudad_actual.zoom }});
            L.geoJson({% if obj.envolvente %}{{ obj.envolvente.geojson|safe }}{% elif obj.ruta %}{{ obj.ruta.geojson|safe }}{% endif %}).addTo(map);
            // asegurarse que carg√≥
            osm.on('load', function(){ setTimeout( function(){alert('loaded')}, 1000)   } )
        </script>
    </body>
</html>