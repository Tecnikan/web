{% extends "maquetado.html" %}
{% load comments %}

{% block custom_top_scripts %}
    <script src="http://openlayers.org/api/OpenLayers.js"></script>
    <script src="http://maps.google.com/maps/api/js?v=3.6&amp;sensor=false"></script>
    <link rel="stylesheet" href="http://openlayers.org/dev/theme/default/style.css" type="text/css" />
{% endblock %}

{% block bloque_izquierda %}
    <ul class="breadcrumb">
        <li><a href="/">Inicio</a> <span class="divider">></span></li>
        <li class="active">{{ciudad_actual.nombre}}</li>
    </ul>

    <h1>Ciudad de {{ciudad_actual.nombre}}</h1>

    <div class="row">
        <div class="span8 thumbnail"><div id="map" style="background:lightblue; height:500px;"></div></div>

        <div class="span3">
            <table class="table table-striped table-bordered table-condensed">
                <thead>
                    <tr>
                    <th>Nombre de la linea</th>
                    </tr>
                </thead>
                <tbody>
                {% for linea in lineas %}
                    <tr>
                        <td><a href="{{linea.slug}}">Linea {{linea.nombre}}</a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <h3>Dejanos un comentario sobre "{{ciudad_actual.nombre}}"</h3>
    <div align="center"><div class="fb-comments" data-href="http://www.cualbondi.com.ar{{request.get_full_path}}" data-num-posts="2" data-width="900"></div></div>

{% endblock %}

{% block custom_ready_function %}
    //Proyeccion que se necesita para transformar proyecciones mas adelante
    var proj = new OpenLayers.Projection("EPSG:4326");

    //Creamos el mapa
    map = new OpenLayers.Map("map", {theme: null})
    var gmap = new OpenLayers.Layer.Google(
        "Google Streets", {numZoomLevels: 20}
    );
    map.addLayers([gmap]);
    map.setCenter(new OpenLayers.LonLat{{ ciudad_actual.centro.coords }}.transform(
        new OpenLayers.Projection("EPSG:4326"),
        map.getProjectionObject()
    ), {{ ciudad_actual.zoom }});

    //Le agregamos una capa para el poligono de la ciudad
    var layer_poligono = new OpenLayers.Layer.Vector("Poligono", {styleMap: new OpenLayers.StyleMap() });
    map.addLayer(layer_poligono)

    //Insertamos el poligono en la nueva capa
    poligono_ciudad = new OpenLayers.Format.WKT().read('{{ciudad_actual.poligono.wkt}}');

    poligono_ciudad.geometry.transform(proj, map.getProjectionObject())
    layer_poligono.addFeatures([poligono_ciudad]);

    //Acomodar el zoom al poligono
    var extent = new OpenLayers.Bounds();
    extent.extend(poligono_ciudad.geometry.getBounds())
    map.zoomToExtent(extent);
{% endblock %}

